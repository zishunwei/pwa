<!DOCTYPE html>
<html>

<head>
  <title>Progressive Web App-Countries</title>
  <meta charset="utf-8" />
  <link rel="manifest" href="/manifest.json">
  <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" name="viewport">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="PWAGram">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-57x57.png" sizes="57x57">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-60x60.png" sizes="60x60">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-72x72.png" sizes="72x72">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-76x76.png" sizes="76x76">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-114x114.png" sizes="114x114">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-120x120.png" sizes="120x120">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-144x144.png" sizes="144x144">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-152x152.png" sizes="152x152">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-180x180.png" sizes="180x180">
  <meta name="msapplication-TileImage" content="/src/images/icons/app-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#fff">
  <meta name="theme-color" content="#3f51b5">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.css' />
  <script src='https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.js'></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <style type="text/css">
    #map {
      width: 600px;
      height: 600px
    }
  </style>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('/sw.js', {
          scope: '/'
        })
        .then(function() {
          console.log('Service worker registered');
        })
        .catch((err) => {
          console.log('Service Worker registration failed: ', err);
        });
    };

    var map;

    $(document).ready(function() {
      $("#basemapslider").slider({
        animate: true,
        value: 1,
        orientation: "vertical",
        min: 0,
        max: 1,
        step: 0.1,
        slide: function(event, ui) {
          mytile.setOpacity(ui.value);
        }
      });

      $('#basemapslider').mousedown(function() {
        map.dragging.disable();
      })

      $('#basemapslider').mouseup(function() {
        map.dragging.enable();
      })

      map = L.map('map').setView([51.52, -0.13], 6);
      var baselayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      var mytile = L.tileLayer('naturalearth/{z}/{x}/{y}.png', {
        maxZoom: 6,
        tms: false,
        attribution: 'Generated by QTiles'
      }).addTo(map);

      L.control.layers({
        'Basemap': baselayer
      }, {
        'naturalearth': mytile
      }).addTo(map);
    })

    function getEarthquakeData() {
      var layerURL =
        "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson";
      $.ajax({
        url: layerURL,
        crossDomain: true,
        success: function(result) {
          console.log(result); // check that the data is correct
          // add the JSON layer onto the map - it will appear using the default icons
          // load the geoJSON layer
          earthquakelayer = L.geoJson(result, {
            // use point to layer to create the points
            pointToLayer: function(feature, latlng) {
              return L.marker(latlng).bindPopup("<b>" + feature.properties.place + "</b>");
            }, // end of point to layer
          }).addTo(map);
          // change the map zoom so that all the data is shown
          map.fitBounds(earthquakelayer.getBounds());
        } // end of the inner function
      }); // end of the ajax request
    } // end of the getEarthquakeData function
  </script>
</head>

<body>
  <div id="map">
    <div id="basemapslidercontainer">
      <div id="basemapslider">
      </div>
    </div>
  </div>

  <button id="loadEarthquakeData" name="loadEarthquakeData" onclick="getEarthquakeData()">Click here to load the Earthquake data
  </button>


</body>

</html>
