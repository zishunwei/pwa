<!DOCTYPE html>
<html>

<head>
  <title>Progressive Web App-Countries</title>
  <meta charset="utf-8" />
  <link rel="manifest" href="/manifest.json">
  <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" name="viewport">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="PWAGram">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-57x57.png" sizes="57x57">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-60x60.png" sizes="60x60">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-72x72.png" sizes="72x72">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-76x76.png" sizes="76x76">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-114x114.png" sizes="114x114">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-120x120.png" sizes="120x120">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-144x144.png" sizes="144x144">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-152x152.png" sizes="152x152">
  <link rel="apple-touch-icon" href="/images/icons/apple-icon-180x180.png" sizes="180x180">
  <meta name="msapplication-TileImage" content="/src/images/icons/app-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#fff">
  <meta name="theme-color" content="#3f51b5">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.css' rel="stylesheet"/>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.js'></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <!-- the following links add the CSS and Javascript required for the Leaflet Map -->
  <link crossorigin="" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
        integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
        rel="stylesheet"/>

  <script crossorigin=""
          integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
          src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"></script>

  <!-- the following links incorporate the CSS required for custom icon creation -->
  <link href="/css/ionicons.min.css" rel="stylesheet">
  <link href="/css/leaflet.awesome-markers.css" rel="stylesheet">
  <script src="/js/leaflet.awesome-markers.js"></script>

  <style type="text/css">
    #map {
      width: 600px;
      height: 600px
    }
  </style>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('/sw.js', {
          scope: '/'
        })
              .then(function () {
                console.log('Service worker registered');
              })
              .catch((err) => {
                console.log('Service Worker registration failed: ', err);
              });
    }
    ;


    var mymap;

    $(document).ready(function () {
      $("#basemapslider").slider({
        animate: true,
        value: 1,
        orientation: "vertical",
        min: 0,
        max: 1,
        step: 0.1,
        slide: function (event, ui) {
          mytile.setOpacity(ui.value);
        }
      });

      $('#basemapslider').mousedown(function() {
        mymap.dragging.disable();
      });

      $('#basemapslider').mouseup(function() {
        mymap.dragging.enable();
      });

      mymap = L.map('map').setView([51.52, -0.13], 9);

      var baselayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(mymap);

      var mytile = L.tileLayer('/uk/{z}/{x}/{y}.png', {
        maxZoom: 11,
        tms: false,
        attribution: 'Generated by QTiles'
      }).addTo(mymap);

      L.control.layers({
        'Basemap': baselayer
      }, {
        'uk': mytile
      }).addTo(mymap);
    });


    // load the earthquake layer
    var earthquakelayer;

    function removeEarthquakeData() {
      alert("Earthquake data will be removed");
      mymap.removeLayer(earthquakelayer);
    }

    function getEarthquakeData() {
      var testMarkerRed = L.AwesomeMarkers.icon({
        icon: 'play',
        markerColor: 'red'
      });
      var testMarkerPink = L.AwesomeMarkers.icon({
        icon: 'play',
        markerColor: 'pink'
      });

      var layerURL =
              "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson";
      $.ajax({
        url: layerURL,
        crossDomain: true,
        success: function (result) {
          console.log(result); // check that the data is correct
          // add the JSON layer onto the map - it will appear using the default icons
          // load the geoJSON layer
          earthquakelayer = L.geoJson(result, {
            // use point to layer to create the points
            pointToLayer: function(feature, latlng) {
              // look at the GeoJSON file - specifically at the properties - to see the
              // earthquake magnitude and use a different marker depending on this value
              // also include a pop-up that shows the place value of the earthquakes
              if (feature.properties.mag > 1.75) {
                return L.marker(latlng, {
                  icon: testMarkerRed
                }).bindPopup("<b>" + feature.properties.place + "</b>");
              } else {
                // magnitude is 1.75 or less
                return L.marker(latlng, {
                  icon: testMarkerPink
                }).bindPopup("<b>" + feature.properties.place + "</b>");
                ;
              }
            }, // end of point to layer
          }).addTo(mymap);
          // change the map zoom so that all the data is shown
          mymap.fitBounds(earthquakelayer.getBounds());
        } // end of the inner function
      }); // end of the ajax request
    } // end of the getEarthquakeData function

    // load the poi layer
    var POIlayer;

    function removePOIData() {
      alert("POI data will be removed");
      mymap.removeLayer(POIlayer);
    }

    function getPOIData() {

      var testMarkerRed = L.AwesomeMarkers.icon({
        icon: 'play',
        markerColor: 'red'
      });

      var testMarkerBlack = L.AwesomeMarkers.icon({
        icon: 'play',
        markerColor: 'black'
      });

      var layerURL =
              "https://developer.cege.ucl.ac.uk:30295/getGeoJSON/london_poi/geom";
      $.ajax({
        url: layerURL,
        crossDomain: true,
        success: function (result) {
          console.log(result); // check that the data is correct
          // add the JSON layer onto the map - it will appear using the default icons
          // load the geoJSON layer
          POIlayer = L.geoJson(result, {
            // use point to layer to create the points
            pointToLayer: function (feature, latlng) {
              // look at the GeoJSON file - specifically at the properties - to see the
              var isParking = feature.properties.name.toLowerCase().indexOf("parking");
              console.log(isParking);
              switch (true) {
                case (isParking > -1):
                  return L.marker(latlng, {
                    icon: testMarkerRed
                  }).bindPopup("<b>" + feature.properties.name + "</b>");
                  break;
                default:
                  return L.marker(latlng, {
                    icon: testMarkerBlack
                  }).bindPopup("<b>" + feature.properties.name + "</b>");
                  break;
              }

            }, // end of point to layer
          }).addTo(mymap);
          // change the map zoom so that all the data is shown
          mymap.fitBounds(POIlayer.getBounds());
        } // end of the inner function
      }); // end of the ajax request
    } // end of the getPOIData function
  </script>
</head>

<body>
<div id="map">
  <div id="basemapslidercontainer">
    <div id="basemapslider">
    </div>
  </div>
</div>

<button id="loadEarthquakeData" name="loadEarthquakeData" onclick="getEarthquakeData()">Click here to load the
  Earthquake data
</button>
<button id="removeEarthquakeData" name="removeEarthquakeData" onclick="removeEarthquakeData()">Click here to remove the
  Earthquake data
</button>

<button id="loadPOIData" name="loadPOIData" onclick="getPOIData()">Click here to load the
  POI data
</button>
<button id="removePOIData" name="removePOIData" onclick="removePOIData()">Click here to remove the
  POI data
</button>


</body>

</html>
